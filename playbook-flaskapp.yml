---
- name: DÃ©ploiement Flask web app ğŸš€
  user: admin
  hosts: vmawsflaskapp
  tasks:
  - name: ğŸ“ Installation de modules
    apt:
      name:
        - python3-dev
        - python3-pip
        - python3-setuptools
        - docker-compose
    become: yes
  - name: ğŸ Installation du module docker pour python (faculatatif)
    shell: "sudo python3 -m pip install docker && sudo python3 -m pip install docker-compose"
    become: yes
  - name: ğŸ†‘ Supprimer les anciens fichiers
    shell: "rm -rf /home/admin/app"
  - name: â˜ Importer le git
    git:
      repo: https://github.com/vilm725/cd4flask.git
      dest: /home/admin/app
      version: "master"
      clone: yes
      update: no
  - name: ğŸ³ ArrÃªt de l'application 
    shell: "sudo docker-compose down"    
    args:
      chdir: /home/admin/app
  - name: ğŸ³ Deploiement du conteneur avec l'application
    shell: "sudo docker-compose up -d"
    args:
      chdir: /home/admin/app
